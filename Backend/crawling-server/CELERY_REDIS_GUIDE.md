# Celeryì™€ Redis ì™„ë²½ ê°€ì´ë“œ

## ğŸ“š ëª©ì°¨
1. [Celeryë€ ë¬´ì—‡ì¸ê°€?](#celeryë€-ë¬´ì—‡ì¸ê°€)
2. [Redisë€ ë¬´ì—‡ì¸ê°€?](#redisë€-ë¬´ì—‡ì¸ê°€)
3. [ì™œ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ”ê°€?](#ì™œ-í•¨ê»˜-ì‚¬ìš©í•˜ëŠ”ê°€)
4. [Celery êµ¬ì„± ìš”ì†Œ](#celery-êµ¬ì„±-ìš”ì†Œ)
5. [Redisì˜ ì—­í• ](#redisì˜-ì—­í• )
6. [ì‹¤ì œ ë™ì‘ íë¦„](#ì‹¤ì œ-ë™ì‘-íë¦„)
7. [í¬ë¡¤ë§ ì„œë²„ ì ìš© ì˜ˆì‹œ](#í¬ë¡¤ë§-ì„œë²„-ì ìš©-ì˜ˆì‹œ)

---

## Celeryë€ ë¬´ì—‡ì¸ê°€?

### ì •ì˜
**Celery**ëŠ” Pythonìœ¼ë¡œ ì‘ì„±ëœ **ë¶„ì‚° ë¹„ë™ê¸° ì‘ì—… í(Distributed Task Queue)** ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### í•µì‹¬ ê°œë…

```
ë™ê¸° ì²˜ë¦¬ (Before):
ì‚¬ìš©ì â†’ ìš”ì²­ â†’ [ì„œë²„ê°€ 30ë¶„ ë™ì•ˆ í¬ë¡¤ë§] â†’ ì‘ë‹µ âŒ ì˜¤ë˜ ê±¸ë¦¼!

ë¹„ë™ê¸° ì²˜ë¦¬ (After - Celery):
ì‚¬ìš©ì â†’ ìš”ì²­ â†’ ì„œë²„: "ì‘ì—… ë“±ë¡í–ˆì–´ìš”!" â†’ ì¦‰ì‹œ ì‘ë‹µ âœ…
                          â†“ (ë°±ê·¸ë¼ìš´ë“œ)
                    Celery Workerê°€ 30ë¶„ ë™ì•ˆ í¬ë¡¤ë§
```

### ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°

**ë ˆìŠ¤í† ë‘ ë¹„ìœ :**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë ˆìŠ¤í† ë‘                              â”‚
â”‚                                                          â”‚
â”‚  ì†ë‹˜ (í´ë¼ì´ì–¸íŠ¸)                                       â”‚
â”‚    â†“ ì£¼ë¬¸                                                â”‚
â”‚  ì¹´ìš´í„° ì§ì› (FastAPI)                                   â”‚
â”‚    â†“ ì£¼ë¬¸ì„œë¥¼ ì£¼ë°©ì— ì „ë‹¬                                â”‚
â”‚  ì£¼ë°© í (Redis)                                         â”‚
â”‚    â†“ ì£¼ë¬¸ì„œ ëŒ€ê¸°                                         â”‚
â”‚  ìš”ë¦¬ì‚¬ (Celery Worker)                                  â”‚
â”‚    â†“ ìŒì‹ ì¡°ë¦¬                                           â”‚
â”‚  ì™„ì„±ëœ ìŒì‹ (Result)                                    â”‚
â”‚    â†“                                                     â”‚
â”‚  ì†ë‹˜ì—ê²Œ ì „ë‹¬                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬:**
- ì†ë‹˜ì€ ì£¼ë¬¸ í›„ **ì¦‰ì‹œ ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ë°›ê³ ** ìë¦¬ë¡œ ëŒì•„ê°
- ìš”ë¦¬ëŠ” **ë°±ê·¸ë¼ìš´ë“œì—ì„œ** ì§„í–‰ë¨
- ì™„ì„±ë˜ë©´ ì•Œë¦¼ì„ ë°›ìŒ

---

## Redisë€ ë¬´ì—‡ì¸ê°€?

### ì •ì˜
**Redis**(Remote Dictionary Server)ëŠ” **ë©”ëª¨ë¦¬ ê¸°ë°˜ Key-Value ë°ì´í„° ì €ì¥ì†Œ**ì…ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•

```
PostgreSQL (ë””ìŠ¤í¬ ê¸°ë°˜ DB):
- ë°ì´í„°ë¥¼ ë””ìŠ¤í¬ì— ì €ì¥
- ëŠë¦¬ì§€ë§Œ ëŒ€ìš©ëŸ‰ ë°ì´í„° ì €ì¥ ê°€ëŠ¥
- ì˜êµ¬ ë³´ì¡´

Redis (ë©”ëª¨ë¦¬ ê¸°ë°˜ DB):
- ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬(RAM)ì— ì €ì¥
- ë§¤ìš° ë¹ ë¦„ (ë§ˆì´í¬ë¡œì´ˆ ë‹¨ìœ„)
- íœ˜ë°œì„± (ì¬ì‹œì‘ ì‹œ ë°ì´í„° ì†ì‹¤ ê°€ëŠ¥)
- ì„ì‹œ ë°ì´í„°, ìºì‹œ, ë©”ì‹œì§€ íì— ìµœì 
```

### Redis ë°ì´í„° êµ¬ì¡°

```python
# 1. String (ë¬¸ìì—´)
SET task_id_123 "í¬ë¡¤ë§ ì¤‘..."
GET task_id_123  # "í¬ë¡¤ë§ ì¤‘..."

# 2. List (íë¡œ ì‚¬ìš©)
LPUSH job_queue "ë´‰ì‚¬ í¬ë¡¤ë§"
LPUSH job_queue "ì·¨ì—… í¬ë¡¤ë§"
RPOP job_queue  # "ë´‰ì‚¬ í¬ë¡¤ë§" (FIFO)

# 3. Hash (ë”•ì…”ë„ˆë¦¬)
HSET task:123 status "SUCCESS" duration "15.2"
HGET task:123 status  # "SUCCESS"

# 4. Sorted Set (ìš°ì„ ìˆœìœ„ í)
ZADD priority_queue 1 "P1_ì‘ì—…"
ZADD priority_queue 2 "P2_ì‘ì—…"
ZPOPMIN priority_queue  # "P1_ì‘ì—…" (ìš°ì„ ìˆœìœ„ ë†’ì€ ê²ƒë¶€í„°)
```

---

## ì™œ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ”ê°€?

### Celery + Redis ì¡°í•©ì˜ ì¥ì 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Celery: "ë‚˜ëŠ” ì‘ì—… ì‹¤í–‰ ì „ë¬¸ê°€ì•¼!"                      â”‚
â”‚  - ì‘ì—… ìŠ¤ì¼€ì¤„ë§                                          â”‚
â”‚  - ë¶„ì‚° ì²˜ë¦¬                                              â”‚
â”‚  - ì¬ì‹œë„ ë¡œì§                                            â”‚
â”‚  - ìš°ì„ ìˆœìœ„ í                                            â”‚
â”‚                                                           â”‚
â”‚  BUT ë©”ì‹œì§€ë¥¼ ì €ì¥í•  ê³µê°„ì´ í•„ìš”í•´...                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis: "ë‚´ê°€ ë©”ì‹œì§€ ì €ì¥/ì „ë‹¬ í•´ì¤„ê²Œ!"                  â”‚
â”‚  - ì´ˆê³ ì† ë©”ì‹œì§€ í                                       â”‚
â”‚  - ì‘ì—… ê²°ê³¼ ì €ì¥                                         â”‚
â”‚  - ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬                                     â”‚
â”‚                                                           â”‚
â”‚  BUT ì‘ì—… ì‹¤í–‰ ê¸°ëŠ¥ì€ ì—†ì–´...                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Celery + Redis = ì™„ë²½í•œ ì¡°í•©! ğŸ’¯                        â”‚
â”‚                                                           â”‚
â”‚  Celeryê°€ ì‘ì—… ì‹¤í–‰                                       â”‚
â”‚  Redisê°€ ë©”ì‹œì§€ ì „ë‹¬ ë° ê²°ê³¼ ì €ì¥                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë‹¤ë¥¸ ì¡°í•©ë“¤

```
Celery + RabbitMQ  âœ… ë§ì´ ì‚¬ìš© (ë” ê°•ë ¥í•œ ë©”ì‹œì§€ ê¸°ëŠ¥)
Celery + Redis     âœ… ë§ì´ ì‚¬ìš© (ê°„ë‹¨í•˜ê³  ë¹ ë¦„)
Celery + Amazon SQS âœ… í´ë¼ìš°ë“œ í™˜ê²½
```

---

## Celery êµ¬ì„± ìš”ì†Œ

### 4ê°€ì§€ í•µì‹¬ ì»´í¬ë„ŒíŠ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Celery Beat (ìŠ¤ì¼€ì¤„ëŸ¬)                               â”‚
â”‚     - ì •í•´ì§„ ì‹œê°„ì— ì‘ì—… íŠ¸ë¦¬ê±°                           â”‚
â”‚     - cron ìŠ¤ì¼€ì¤„ ì§€ì›                                    â”‚
â”‚     - ì˜ˆ: ë§¤ 2ì‹œê°„ë§ˆë‹¤ í¬ë¡¤ë§ ì‹¤í–‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼ (ì‘ì—… ìƒì„±)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Broker (Redis)                                       â”‚
â”‚     - ì‘ì—…ì„ íì— ì €ì¥                                    â”‚
â”‚     - Workerì—ê²Œ ì‘ì—… ì „ë‹¬                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼ (ì‘ì—… ê°€ì ¸ì˜¤ê¸°)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Celery Worker (ì‘ì—…ì)                               â”‚
â”‚     - ì‹¤ì œë¡œ ì‘ì—… ì‹¤í–‰                                    â”‚
â”‚     - ì—¬ëŸ¬ Worker ë™ì‹œ ì‹¤í–‰ ê°€ëŠ¥ (ìˆ˜í‰ í™•ì¥)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼ (ê²°ê³¼ ì €ì¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Result Backend (Redis)                               â”‚
â”‚     - ì‘ì—… ê²°ê³¼ ì €ì¥                                      â”‚
â”‚     - ì„±ê³µ/ì‹¤íŒ¨ ìƒíƒœ                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. Celery Beat (ìŠ¤ì¼€ì¤„ëŸ¬)

**ì—­í• :** ì •í•´ì§„ ì‹œê°„ì— ìë™ìœ¼ë¡œ ì‘ì—… íŠ¸ë¦¬ê±°

```python
# tasks.py
celery_app.conf.beat_schedule = {
    "ë´‰ì‚¬-í¬ë¡¤ë§-2ì‹œê°„ë§ˆë‹¤": {
        "task": "tasks.college_crawl_task",
        "schedule": crontab(minute=0, hour="*/2"),  # 2ì‹œê°„ë§ˆë‹¤
        "args": ("ë´‰ì‚¬ ê³µì§€ì‚¬í•­ í¬ë¡¤ë§",)
    }
}
```

**ì‹¤í–‰ ì˜ˆì‹œ:**
```
00:00  Beat: "ë´‰ì‚¬ í¬ë¡¤ë§ ì‹œì‘!" â†’ Redis íì— ì¶”ê°€
02:00  Beat: "ë´‰ì‚¬ í¬ë¡¤ë§ ì‹œì‘!" â†’ Redis íì— ì¶”ê°€
04:00  Beat: "ë´‰ì‚¬ í¬ë¡¤ë§ ì‹œì‘!" â†’ Redis íì— ì¶”ê°€
...
```

### 2. Broker (Redis) - ë©”ì‹œì§€ í

**ì—­í• :** ì‘ì—…ì„ íì— ì €ì¥í•˜ê³  Workerì—ê²Œ ì „ë‹¬

```python
# Redisì— ì €ì¥ë˜ëŠ” ë°ì´í„° (ë‚´ë¶€ì ìœ¼ë¡œ)
{
    "task": "tasks.college_crawl_task",
    "args": ["ë´‰ì‚¬ ê³µì§€ì‚¬í•­ í¬ë¡¤ë§"],
    "kwargs": {},
    "id": "abc-123-def",
    "eta": null,
    "expires": null
}
```

**í êµ¬ì¡°:**
```
Redis Queue (celery:default):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task 1: ë´‰ì‚¬ í¬ë¡¤ë§      â”‚ â† Workerê°€ ì—¬ê¸°ì„œ ê°€ì ¸ê°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Task 2: ì·¨ì—… í¬ë¡¤ë§      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Task 3: ì¥í•™ê¸ˆ í¬ë¡¤ë§    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Celery Worker (ì‘ì—…ì)

**ì—­í• :** íì—ì„œ ì‘ì—…ì„ ê°€ì ¸ì™€ ì‹¤ì œë¡œ ì‹¤í–‰

```bash
# Worker ì‹¤í–‰ ëª…ë ¹ì–´
celery -A tasks worker --loglevel=info

# ì¶œë ¥ ì˜ˆì‹œ
[2025-11-18 10:00:00] Received task: tasks.college_crawl_task
[2025-11-18 10:00:01] Task started: ë´‰ì‚¬ ê³µì§€ì‚¬í•­ í¬ë¡¤ë§
[2025-11-18 10:00:15] Task completed: 50ê°œ ìˆ˜ì§‘, 10ê°œ ì €ì¥
```

**ìˆ˜í‰ í™•ì¥ (ì—¬ëŸ¬ Worker):**
```
Worker 1: ë´‰ì‚¬ í¬ë¡¤ë§ ì‹¤í–‰ ì¤‘...
Worker 2: ì·¨ì—… í¬ë¡¤ë§ ì‹¤í–‰ ì¤‘...
Worker 3: ì¥í•™ê¸ˆ í¬ë¡¤ë§ ì‹¤í–‰ ì¤‘...
Worker 4: ëŒ€ê¸° ì¤‘...

â†’ ë™ì‹œì— ì—¬ëŸ¬ ì‘ì—… ì²˜ë¦¬ ê°€ëŠ¥!
```

### 4. Result Backend (Redis) - ê²°ê³¼ ì €ì¥

**ì—­í• :** ì‘ì—… ì™„ë£Œ í›„ ê²°ê³¼ ì €ì¥

```python
# Redisì— ì €ì¥ë˜ëŠ” ê²°ê³¼ (ë‚´ë¶€ì ìœ¼ë¡œ)
{
    "task_id": "abc-123-def",
    "status": "SUCCESS",
    "result": {
        "total_items": 50,
        "saved_items": 10,
        "duration": 15.2
    },
    "traceback": null,
    "children": []
}
```

**ì¡°íšŒ:**
```python
# ì‘ì—… ê²°ê³¼ ì¡°íšŒ
result = college_crawl_task.delay("ë´‰ì‚¬ í¬ë¡¤ë§")
result.get()  # ê²°ê³¼ê°€ ë‚˜ì˜¬ ë•Œê¹Œì§€ ëŒ€ê¸°
# â†’ {"total_items": 50, "saved_items": 10}
```

---

## Redisì˜ ì—­í• 

### 1. Broker (ë©”ì‹œì§€ í) ì—­í• 

**Celeryê°€ Redisë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€?**

```python
# tasks.py
BROKER_URL = "redis://localhost:6379/0"  # Redis DB 0ë²ˆ

celery_app = Celery(
    "school_notices",
    broker=BROKER_URL
)
```

**Redis ë‚´ë¶€ êµ¬ì¡°:**
```
Redis DB 0:
â”œâ”€ celery:default (List)
â”‚  â”œâ”€ task1
â”‚  â”œâ”€ task2
â”‚  â””â”€ task3
â”‚
â”œâ”€ celery:high_priority (List)
â”‚  â”œâ”€ urgent_task1
â”‚  â””â”€ urgent_task2
â”‚
â””â”€ celery:low_priority (List)
   â””â”€ background_task1
```

**ë°ì´í„° íë¦„:**
```python
# 1. ì‘ì—… ì¶”ê°€ (Producer)
college_crawl_task.delay("ë´‰ì‚¬ í¬ë¡¤ë§")
  â†“
Redis: LPUSH celery:default "task_data"

# 2. ì‘ì—… ê°€ì ¸ì˜¤ê¸° (Consumer/Worker)
Worker: BRPOP celery:default  # Blocking Right Pop
  â†“
Redis: "task_data" ë°˜í™˜ ë° íì—ì„œ ì œê±°
```

### 2. Result Backend ì—­í• 

```python
# tasks.py
RESULT_BACKEND = "redis://localhost:6379/1"  # Redis DB 1ë²ˆ

celery_app = Celery(
    "school_notices",
    backend=RESULT_BACKEND
)
```

**Redis ë‚´ë¶€ êµ¬ì¡°:**
```
Redis DB 1:
â”œâ”€ celery-task-meta-abc123 (Hash)
â”‚  â”œâ”€ status: "SUCCESS"
â”‚  â”œâ”€ result: "{\"total\": 50}"
â”‚  â””â”€ traceback: null
â”‚
â”œâ”€ celery-task-meta-def456 (Hash)
â”‚  â”œâ”€ status: "PENDING"
â”‚  â””â”€ ...
â”‚
â””â”€ celery-task-meta-ghi789 (Hash)
   â”œâ”€ status: "FAILURE"
   â”œâ”€ result: null
   â””â”€ traceback: "ValueError: ..."
```

**ìƒíƒœ ì¡°íšŒ:**
```python
# ì‘ì—… íŠ¸ë¦¬ê±°
result = college_crawl_task.delay("ë´‰ì‚¬ í¬ë¡¤ë§")

# ìƒíƒœ í™•ì¸
result.status  # "PENDING" â†’ "STARTED" â†’ "SUCCESS"

# ê²°ê³¼ ëŒ€ê¸° (Blocking)
final_result = result.get(timeout=60)
# â†’ {"total_items": 50, "saved_items": 10}
```

### 3. Redisì˜ ì„±ëŠ¥ ì´ì 

```
PostgreSQL vs Redis (ì‘ì—… í ë¹„êµ):

PostgreSQL:
â”œâ”€ ë””ìŠ¤í¬ ê¸°ë°˜ â†’ ëŠë¦¼ (ë°€ë¦¬ì´ˆ)
â”œâ”€ ACID ë³´ì¥ â†’ ì˜¤ë²„í—¤ë“œ
â””â”€ ë³µì¡í•œ ì¿¼ë¦¬ ê°€ëŠ¥

Redis:
â”œâ”€ ë©”ëª¨ë¦¬ ê¸°ë°˜ â†’ ë¹ ë¦„ (ë§ˆì´í¬ë¡œì´ˆ)
â”œâ”€ ë‹¨ìˆœí•œ ë°ì´í„° êµ¬ì¡°
â””â”€ ë©”ì‹œì§€ íì— ìµœì í™”

ê²°ë¡ : ë©”ì‹œì§€ íëŠ” Redisê°€ ì••ë„ì ìœ¼ë¡œ ìœ ë¦¬!
```

---

## ì‹¤ì œ ë™ì‘ íë¦„

### ì „ì²´ ì‹œìŠ¤í…œ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: ìŠ¤ì¼€ì¤„ëŸ¬ íŠ¸ë¦¬ê±°                                 â”‚
â”‚                                                          â”‚
â”‚  Celery Beat (00:00):                                   â”‚
â”‚  "ë´‰ì‚¬ í¬ë¡¤ë§ ì‹œê°„ì´ì•¼!"                                 â”‚
â”‚  college_crawl_task.delay("ë´‰ì‚¬ ê³µì§€ì‚¬í•­ í¬ë¡¤ë§")       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Redis Brokerì— ì‘ì—… ì¶”ê°€                        â”‚
â”‚                                                          â”‚
â”‚  Redis (Broker):                                        â”‚
â”‚  LPUSH celery:default {                                 â”‚
â”‚    "task": "college_crawl_task",                        â”‚
â”‚    "args": ["ë´‰ì‚¬ ê³µì§€ì‚¬í•­ í¬ë¡¤ë§"],                     â”‚
â”‚    "id": "abc-123-def"                                  â”‚
â”‚  }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: Workerê°€ íì—ì„œ ì‘ì—… ê°€ì ¸ì˜¤ê¸°                   â”‚
â”‚                                                          â”‚
â”‚  Celery Worker:                                         â”‚
â”‚  task = BRPOP celery:default                            â”‚
â”‚  "íì—ì„œ ì‘ì—… ê°€ì ¸ì™”ì–´!"                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: ì‘ì—… ì‹¤í–‰                                       â”‚
â”‚                                                          â”‚
â”‚  def college_crawl_task(job_name):                      â”‚
â”‚      # í¬ë¡¤ë§ ì‹¤í–‰                                       â”‚
â”‚      results = crawler.crawl_volunteer()                â”‚
â”‚      # 50ê°œ ê³µì§€ì‚¬í•­ ìˆ˜ì§‘                                â”‚
â”‚      # ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥                                 â”‚
â”‚      return {"total": 50, "saved": 10}                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: Redis Backendì— ê²°ê³¼ ì €ì¥                       â”‚
â”‚                                                          â”‚
â”‚  Redis (Result Backend):                                â”‚
â”‚  HSET celery-task-meta-abc123 {                         â”‚
â”‚    "status": "SUCCESS",                                 â”‚
â”‚    "result": "{\"total\": 50, \"saved\": 10}"           â”‚
â”‚  }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 6: ê²°ê³¼ ì¡°íšŒ (ì„ íƒì )                              â”‚
â”‚                                                          â”‚
â”‚  API ë˜ëŠ” ëŒ€ì‹œë³´ë“œ:                                      â”‚
â”‚  result.get()                                           â”‚
â”‚  â†’ {"total": 50, "saved": 10}                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### íƒ€ì„ë¼ì¸ ì˜ˆì‹œ

```
00:00:00.000  Celery Beat: ì‘ì—… íŠ¸ë¦¬ê±°
00:00:00.001  Redis Broker: ì‘ì—… ì¶”ê°€ (LPUSH)
00:00:00.002  Celery Worker: ì‘ì—… ê°€ì ¸ì˜¤ê¸° (BRPOP)
00:00:00.003  Worker: college_crawl_task ì‹œì‘
00:00:00.010  Worker: HTTP ìš”ì²­ (í˜ì´ì§€ 1)
00:00:02.500  Worker: HTTP ìš”ì²­ (í˜ì´ì§€ 2)
00:00:05.000  Worker: HTTP ìš”ì²­ (í˜ì´ì§€ 3)
00:00:07.500  Worker: HTTP ìš”ì²­ (í˜ì´ì§€ 4)
00:00:10.000  Worker: HTTP ìš”ì²­ (í˜ì´ì§€ 5)
00:00:12.000  Worker: ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ (50ê°œ ì¤‘ 10ê°œ)
00:00:15.200  Worker: ì‘ì—… ì™„ë£Œ
00:00:15.201  Redis Backend: ê²°ê³¼ ì €ì¥ (HSET)
00:00:15.202  Worker: ë‹¤ìŒ ì‘ì—… ëŒ€ê¸°...
```

---

## í¬ë¡¤ë§ ì„œë²„ ì ìš© ì˜ˆì‹œ

### ì‹¤ì œ ì½”ë“œ ë¶„ì„

#### 1. Celery ì•± ì´ˆê¸°í™” (tasks.py)

```python
from celery import Celery

# Redis ì—°ê²° ì •ë³´
BROKER_URL = "redis://localhost:6379/0"
RESULT_BACKEND = "redis://localhost:6379/1"

# Celery ì•± ìƒì„±
celery_app = Celery(
    "school_notices",
    broker=BROKER_URL,        # ì‘ì—… íìš© Redis
    backend=RESULT_BACKEND,   # ê²°ê³¼ ì €ì¥ìš© Redis
)

# ì„¤ì •
celery_app.conf.update(
    task_serializer="json",           # JSON ì§ë ¬í™”
    accept_content=["json"],
    result_serializer="json",
    timezone="Asia/Seoul",            # í•œêµ­ ì‹œê°„ëŒ€
    enable_utc=True,
    task_track_started=True,          # ì‘ì—… ì‹œì‘ ì¶”ì 
    task_time_limit=30 * 60,          # 30ë¶„ ìµœëŒ€ ì‹¤í–‰
    task_soft_time_limit=25 * 60,     # 25ë¶„ ì†Œí”„íŠ¸ íƒ€ì„ì•„ì›ƒ
    worker_prefetch_multiplier=1,     # í•œ ë²ˆì— 1ê°œì”© ê°€ì ¸ì˜¤ê¸°
)
```

#### 2. ìŠ¤ì¼€ì¤„ ë“±ë¡ (auto_scheduler.py)

```python
# Celery Beat ìŠ¤ì¼€ì¤„ ì—…ë°ì´íŠ¸
celery_app.conf.beat_schedule = {
    "college-ë´‰ì‚¬-í¬ë¡¤ë§": {
        "task": "tasks.college_crawl_task",  # ì‹¤í–‰í•  íƒœìŠ¤í¬
        "schedule": crontab(minute=0, hour="*/2"),  # 2ì‹œê°„ë§ˆë‹¤
        "args": ("ë´‰ì‚¬ ê³µì§€ì‚¬í•­ í¬ë¡¤ë§",),
        "options": {"priority": 1}  # ìš°ì„ ìˆœìœ„ P1
    },
    "college-ì·¨ì—…-í¬ë¡¤ë§": {
        "task": "tasks.college_crawl_task",
        "schedule": crontab(minute=0, hour="*/3"),  # 3ì‹œê°„ë§ˆë‹¤
        "args": ("ì·¨ì—… ê³µì§€ì‚¬í•­ í¬ë¡¤ë§",),
        "options": {"priority": 1}
    }
}
```

#### 3. ì‘ì—… ì •ì˜ (tasks.py)

```python
@celery_app.task(bind=True, max_retries=3, default_retry_delay=30)
def college_crawl_task(self, job_name: str):
    """
    ëŒ€í•™ ê³µì§€ì‚¬í•­ í¬ë¡¤ë§ íƒœìŠ¤í¬

    Args:
        job_name: ì‘ì—… ì´ë¦„ (ì˜ˆ: "ë´‰ì‚¬ ê³µì§€ì‚¬í•­ í¬ë¡¤ë§")

    Returns:
        dict: í¬ë¡¤ë§ ê²°ê³¼
    """
    try:
        # 1. í¬ë¡¤ë§ ì‹¤í–‰
        if job_name == "ë´‰ì‚¬ ê³µì§€ì‚¬í•­ í¬ë¡¤ë§":
            results = college_crawler.crawl_volunteer()
        elif job_name == "ì·¨ì—… ê³µì§€ì‚¬í•­ í¬ë¡¤ë§":
            results = college_crawler.crawl_job()

        # 2. ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥
        saved_count = save_to_database(results)

        # 3. ê²°ê³¼ ë°˜í™˜ (Redis Backendì— ì €ì¥ë¨)
        return {
            "status": "success",
            "total_items": len(results),
            "saved_items": saved_count
        }

    except Exception as exc:
        # ì¬ì‹œë„ (ì§€ìˆ˜ ë°±ì˜¤í”„)
        self.retry(exc=exc, countdown=(2**self.request.retries) + 5)
```

#### 4. ìˆ˜ë™ íŠ¸ë¦¬ê±° (main.py)

```python
@app.post("/run-crawler/{category}")
async def run_crawler(category: str):
    """íŠ¹ì • ì¹´í…Œê³ ë¦¬ í¬ë¡¤ëŸ¬ ìˆ˜ë™ ì‹¤í–‰"""

    # Celery íƒœìŠ¤í¬ íŠ¸ë¦¬ê±°
    task = college_crawl_task.delay("ë´‰ì‚¬ ê³µì§€ì‚¬í•­ í¬ë¡¤ë§")

    return {
        "status": "success",
        "task_id": task.id,  # abc-123-def
        "message": "ë°±ê·¸ë¼ìš´ë“œì—ì„œ í¬ë¡¤ë§ ì‹œì‘"
    }
```

### Redis ë°ì´í„° í™•ì¸

**Redis CLIë¡œ í™•ì¸:**

```bash
# Redis ì ‘ì†
redis-cli

# 1. Broker (ì‘ì—… í) í™•ì¸
LLEN celery:default
# â†’ 3 (íì— 3ê°œ ì‘ì—… ëŒ€ê¸° ì¤‘)

LRANGE celery:default 0 -1
# â†’ ["task1", "task2", "task3"]

# 2. Result Backend (ê²°ê³¼) í™•ì¸
HGETALL celery-task-meta-abc123
# â†’ status: "SUCCESS"
# â†’ result: "{\"total\": 50, \"saved\": 10}"

# 3. ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
MONITOR
# â†’ Redisì— ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  ëª…ë ¹ì–´ ì‹¤ì‹œê°„ ì¶œë ¥
```

### ì‹¤í–‰ ëª…ë ¹ì–´

```bash
# 1. Celery Worker ì‹œì‘ (ì‘ì—… ì‹¤í–‰)
celery -A worker_app worker --loglevel=info

# 2. Celery Beat ì‹œì‘ (ìŠ¤ì¼€ì¤„ëŸ¬)
celery -A worker_app beat --loglevel=info

# 3. Worker + Beat ë™ì‹œ ì‹¤í–‰
celery -A worker_app worker --beat --loglevel=info

# 4. ì—¬ëŸ¬ Worker ì‹¤í–‰ (ìˆ˜í‰ í™•ì¥)
celery -A worker_app worker --concurrency=4

# 5. Flower ëª¨ë‹ˆí„°ë§ (ì„ íƒ)
celery -A worker_app flower
# â†’ http://localhost:5555 ì—ì„œ ì›¹ ëŒ€ì‹œë³´ë“œ
```

---

## ğŸ¯ í•µì‹¬ ìš”ì•½

### Celeryì˜ ì—­í• 

```
âœ… ì‘ì—… ìŠ¤ì¼€ì¤„ë§ (cron)
âœ… ë¹„ë™ê¸° ì‘ì—… ì‹¤í–‰
âœ… ë¶„ì‚° ì²˜ë¦¬ (ì—¬ëŸ¬ Worker)
âœ… ì¬ì‹œë„ ë¡œì§
âœ… ìš°ì„ ìˆœìœ„ í
âœ… ì‘ì—… ì²´ì¸/ê·¸ë£¹
```

### Redisì˜ ì—­í• 

```
âœ… Broker: ì‘ì—… í (ë©”ì‹œì§€ ì „ë‹¬)
âœ… Result Backend: ê²°ê³¼ ì €ì¥
âœ… ì´ˆê³ ì† ì²˜ë¦¬ (ë©”ëª¨ë¦¬ ê¸°ë°˜)
âœ… ë‹¤ì–‘í•œ ë°ì´í„° êµ¬ì¡° (List, Hash, Set, Sorted Set)
```

### í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

```
Celery = ì‘ì—… ì‹¤í–‰ ì—”ì§„
Redis = ë°ì´í„° ì €ì¥ì†Œ + ë©”ì‹œì§€ í

Celery + Redis = ì™„ë²½í•œ ë¹„ë™ê¸° ì‘ì—… ì‹œìŠ¤í…œ!
```

---

## ğŸ”„ ì‘ì—… íë¦„ ìš”ì•½

```
1. Celery Beat: ì •í•´ì§„ ì‹œê°„ì— ì‘ì—… íŠ¸ë¦¬ê±°
   â†“
2. Redis Broker: ì‘ì—…ì„ íì— ì €ì¥
   â†“
3. Celery Worker: íì—ì„œ ì‘ì—… ê°€ì ¸ì˜¤ê¸°
   â†“
4. Worker: ì‘ì—… ì‹¤í–‰ (í¬ë¡¤ë§, ë°ì´í„° ì²˜ë¦¬ ë“±)
   â†“
5. Redis Result Backend: ê²°ê³¼ ì €ì¥
   â†“
6. API/ëŒ€ì‹œë³´ë“œ: ê²°ê³¼ ì¡°íšŒ (ì„ íƒì )
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

- **Celery ê³µì‹ ë¬¸ì„œ**: https://docs.celeryq.dev/
- **Redis ê³µì‹ ë¬¸ì„œ**: https://redis.io/docs/
- **Celery + Redis íŠœí† ë¦¬ì–¼**: https://docs.celeryq.dev/en/stable/getting-started/

---

## ğŸ’¡ ì‹¤ë¬´ íŒ

### 1. Worker ìˆ˜ ì¡°ì •

```bash
# CPU ì½”ì–´ ìˆ˜ì— ë§ì¶° ì¡°ì •
celery -A worker_app worker --concurrency=8

# ìë™ ì¡°ì • (CPU ì½”ì–´ ìˆ˜ ê¸°ë°˜)
celery -A worker_app worker --autoscale=10,3
# â†’ ìµœëŒ€ 10ê°œ, ìµœì†Œ 3ê°œ
```

### 2. ì‘ì—… ìš°ì„ ìˆœìœ„

```python
# ë†’ì€ ìš°ì„ ìˆœìœ„ ì‘ì—…
high_priority_task.apply_async(priority=0)

# ë‚®ì€ ìš°ì„ ìˆœìœ„ ì‘ì—…
low_priority_task.apply_async(priority=9)
```

### 3. ì‘ì—… íƒ€ì„ì•„ì›ƒ

```python
@celery_app.task(time_limit=300)  # 5ë¶„
def long_running_task():
    # 5ë¶„ ë„˜ìœ¼ë©´ ìë™ ì¢…ë£Œ
    pass
```

### 4. ì¬ì‹œë„ ì „ëµ

```python
@celery_app.task(
    bind=True,
    max_retries=5,
    default_retry_delay=60  # 1ë¶„
)
def retry_task(self):
    try:
        # ì‘ì—… ì‹¤í–‰
        pass
    except Exception as exc:
        # ì§€ìˆ˜ ë°±ì˜¤í”„: 1ë¶„, 2ë¶„, 4ë¶„, 8ë¶„, 16ë¶„
        self.retry(
            exc=exc,
            countdown=2 ** self.request.retries * 60
        )
```

---

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
